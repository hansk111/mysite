{% extends 'main_base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" media="screen, print" href="{% static 'css/statistics/chartjs/chartjs.css' %}">
<main id="js-page-content" role="main" class="page-content">
    <ol class="breadcrumb page-breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'index' %}" title="Main 화면으로">SmartHAN</a></li>
        <li class="breadcrumb-item"><a href="" title="블로그를 화면으로">골프</a></li>
       
        <li class="breadcrumb-item active">필드 스코어</li>
        
        <li class="position-absolute pos-top pos-right d-none d-sm-block"><span class="js-get-date"></span></li>
    </ol>                    
                        
    <div class="row">

        <div class="col-xl-12">
            <div class="row">
                <div class="col-xl-12">
                    <div id="panel-3" class="panel">
                        <div class="panel-hdr">
                            <h2>
                               필드 스코어 <span class="fw-300" id = "han3"><i>나의 기록</i></span>
                            </h2>
                            <div class="input-group col-3">
                                <select class="form-control shadow-inset-2 ye">
                                    <option class="dropdown-item input-group-text" value="all" {% if ye == 'all' %}selected{% endif %}>all</option>
                                    <option class="dropdown-item input-group-text" value="2018" {% if ye == '2018' %}selected{% endif %}>2018</option>
                                    <option class="dropdown-item input-group-text" value="2019" {% if ye == '2019' %}selected{% endif %}>2019</option>
                                    <option class="dropdown-item input-group-text" value="2020" {% if ye == '2020' %}selected{% endif %}>2020</option>
                                    <option class="dropdown-item input-group-text" value="2021" {% if ye == '2021' %}selected{% endif %}>2021</option>
                                </select>
                            </div>
                            <div class="panel-toolbar">
                                <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
                                <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
                                <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10" data-original-title="Close"></button>
                            </div>
                        </div>
                        <div class="panel-container show">
                            <div class="panel-content">
                                {% if ye == 'all' %}  
                                                          
                                <div class="panel-tag">
                                     필드 스코어  
                                </div>
                                {% include "golf/kpi.html" %}
                                {% elif ye == '2018' %}
                                <div class="panel-tag">
                                   2018 필드 스코어
                                </div>
                                {% include "golf/kpi.html" %}
                                {% elif ye == '2019' %}
                                <div class="panel-tag">
                                   2019 필드 스코어
                                </div>
                                {% include "golf/kpi.html" %}
                                {% elif ye == '2020' %}
                                <div class="panel-tag">
                                   
                                    2020 필드 스코어
                                </div>
                                {% include "golf/kpi.html" %}
                                {% else %}
                                <div class="panel-tag">
                                    2021 필드 스코어
                                </div>
                                {% include "golf/kpi.html" %}
                                {% endif %}
                                
                                <div id="barlineCombine1">
                                    <canvas style="width:100%; height:300px;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        <form id="searchForm" method="post" action="{% url 'golf:screengolf' %}">
            {% csrf_token %}
            <input type="hidden" id="ye" name="ye" value="{{ ye }}">
           
        </form>

        
    </div>


    <div class="row">

        <div class="col-xl-12">
            <div class="row">
                <div class="col-xl-12">
                    <div id="panel-3" class="panel">
                        <div class="panel-hdr">
                            <h2>
                               지도 <span class="fw-300" id = "han3"><i>지도</i></span>
                            </h2>
                            
                            <div class="panel-toolbar">
                                <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
                                <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
                                <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10" data-original-title="Close"></button>
                            </div>
                        </div>
                        <div class="panel-container show">
                            <div class="panel-content">

                                <div id="map" style="height:800px;"></div>
                                <p>
                                    <input type="checkbox" id="chkUseDistrict" onclick="setOverlayMapTypeId()" /> 지적편집도 정보 보기
                                    <input type="checkbox" id="chkTerrain" onclick="setOverlayMapTypeId()" /> 지형정보 보기 
                                    <input type="checkbox" id="chkTraffic" onclick="setOverlayMapTypeId()" /> 교통정보 보기       
                                    <input type="checkbox" id="chkBicycle" onclick="setOverlayMapTypeId()" /> 자전거도로 정보 보기
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</main>
{% endblock %}

{% block script %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=38bf3783a685752ad3a649fc447ef74b"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=38bf3783a685752ad3a649fc447ef74b&libraries=services,clusterer,drawing"></script>

<script src="{% static 'js/statistics/chartjs/chartjs.bundle.js' %}"></script>
<script>
    /* bar & line combine1 */
    var barlineCombine1 = function()
        {
            var barlineCombineData1 = {
                labels: [
                        {% for ma in fieldscore %}
                            '{{ ma.date }}'
                            {% if not forloop.last %},{% endif %}  //마지막 loop의 마지막이 아닐경우 ,를 붙인다
                        {% endfor %} 
                ],
                datasets: [
                {
                    
                    type: 'line',
                    label: '필드 스코어',
                    borderColor: color.danger._300,
                    pointBackgroundColor: color.danger._500,
                    pointBorderColor: color.danger._500,
                    pointBorderWidth: 1,
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 5,
                    fill: false,
                    data: [
                                {% for ma in fieldscore %}
                                    '{{ ma.score }}'
                                    {% if not forloop.last %},{% endif %}  //마지막 loop의 마지막이 아닐경우 ,를 붙인다
                                {% endfor %}
                    ]
                },
                
    
                
               
                ]
    
            };
            var config = {
                type: 'bar',
                data: barlineCombineData1,
                options:
                {
                    responsive: true,
                    legend:
                    {
                        position: 'top',
                    },
                    title:
                    {
                        display: true,
                        text: '필드 스코어'
                    },
                    scales:
                    {
                        xAxes: [
                        {
                            display: true,
                            scaleLabel:
                            {
                                display: true,
                                labelString: '날짜'
                            },
                            gridLines:
                            {
                                display: true,
                                color: "#f2f2f2"
                            },
                            ticks:
                            {
                                beginAtZero: true,
                                fontSize: 11
                            }
                        }],
                        yAxes: [
                        {
                           
                            display: true,
                            scaleLabel:
                            {
                                display: false,
                                labelString: 'Profit margin (approx)'
                            },
                            gridLines:
                            {
                                display: true,
                                color: "#f2f2f2"
                            },
                            ticks: {
                                max: 110,
                                min: 70,
                                fontSize: 11,
                                beginAtZero: false,    
                            }
                            
                        },
                        
                    ]
                    }
                }
            }
            new Chart($("#barlineCombine1 > canvas").get(0).getContext("2d"), config);
        }
        /* bar & line combine1 -- end */
    
      /* initialize all charts */
      $(document).ready(function()
        {
           
           
           
                  
            barlineCombine1();
           
        });
    
    
</script>

<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = { 
            center: new kakao.maps.LatLng(37.57319, 126.96658), // 지도의 중심좌표
            level: 7 // 지도의 확대 레벨
        };
    
    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
    
    // 지도 타입 정보를 가지고 있을 객체입니다
    // map.addOverlayMapTypeId 함수로 추가된 지도 타입은
    // 가장 나중에 추가된 지도 타입이 가장 앞에 표시됩니다
    // 이 예제에서는 지도 타입을 추가할 때 지적편집도, 지형정보, 교통정보, 자전거도로 정보 순으로 추가하므로
    // 자전거 도로 정보가 가장 앞에 표시됩니다
    var mapTypes = {
        terrain : kakao.maps.MapTypeId.TERRAIN,    
        traffic :  kakao.maps.MapTypeId.TRAFFIC,
        bicycle : kakao.maps.MapTypeId.BICYCLE,
        useDistrict : kakao.maps.MapTypeId.USE_DISTRICT
    };
    var mapTypeControl = new kakao.maps.MapTypeControl();
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
    var zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    // 체크 박스를 선택하면 호출되는 함수입니다
    function setOverlayMapTypeId() {
        var chkTerrain = document.getElementById('chkTerrain'),  
            chkTraffic = document.getElementById('chkTraffic'),
            chkBicycle = document.getElementById('chkBicycle'),
            chkUseDistrict = document.getElementById('chkUseDistrict');
        
        // 지도 타입을 제거합니다
        for (var type in mapTypes) {
            map.removeOverlayMapTypeId(mapTypes[type]);    
        }
    
        // 지적편집도정보 체크박스가 체크되어있으면 지도에 지적편집도정보 지도타입을 추가합니다
        if (chkUseDistrict.checked) {
            map.addOverlayMapTypeId(mapTypes.useDistrict);    
        }
        
        // 지형정보 체크박스가 체크되어있으면 지도에 지형정보 지도타입을 추가합니다
        if (chkTerrain.checked) {
            map.addOverlayMapTypeId(mapTypes.terrain);    
        }
        
        // 교통정보 체크박스가 체크되어있으면 지도에 교통정보 지도타입을 추가합니다
        if (chkTraffic.checked) {
            map.addOverlayMapTypeId(mapTypes.traffic);    
        }
        
        // 자전거도로정보 체크박스가 체크되어있으면 지도에 자전거도로정보 지도타입을 추가합니다
        if (chkBicycle.checked) {
            map.addOverlayMapTypeId(mapTypes.bicycle);    
        }
        
    }  
    </script>
<script type='text/javascript'>
    $(document).ready(function(){
       
    
      
    
      
    
        $(".ye").on('change', function() {
                $("#ye").val($(this).val());
                
                $("#searchForm").submit();
        });
        
       
    
       
      
    
    });
    </script>
    {% endblock %}